"use strict";!function(e){function t(e,t){var n={tgsb:"m"};for(var a in t)n[a]=t[a];this.tgsb=n.tgsb,this.city_name="",this.end_flag=!0,this.init()}var n=this;t.prototype={init:function(){this.city_name=null!=this.getQueryString("city")?this.getQueryString("city"):"bj",this.hd_name=this.fieldUrl(),this.itmeTab(),this.alertInfo(),this.choujiang(this.city_name),this.footerBtn()},choujiang:function(e){var t=this;$("#zhuan_zhi_m").on("click",function(){if(t.endTime(),!t.end_flag)return!1;var n="";n=null!=t.getQueryString("refcode")?t.baseJia(t.getQueryString("refcode"),!1):"";var a=getCookie("zj_tow11_phone");null!=a?t.judgeChou({city_name:e,zjfrom:t.getZjfrom(),phone:a}):t.alertChoujiang(t.hd_name,n)})},alertChoujiang:function(e,t){$(".message").css({height:window.innerHeight+"px",width:window.innerWidth+"px"}).show(),window.scrollTo(0,0),$("body").on("touchmove",function(e){e.preventDefault},!1),$(".wrap").Liuzi({nameId:$("#hd_name_info"),phoneId:$("#hd_phone_info"),yanzmId:$("#hd_yanzm_info"),yanzmBtn:$("#hd_yanzmBtn_info"),hdBtn:$("#hd_btn_info"),nameError:$("#name_error_info"),yanError:$("#yan_error_info"),phoneError:$("#phone_error_info"),yanBtnColor:"yanzm_btncolor",huodongUrl:"http://webapi.zeju.com/liuzi/hd_shoppingday_liuzi",tgsb:"m",cityName:this.city_name,hd_name:e,refcode:t,yanzmText:"获取",layoutType:5,hd_alertArr:{succeedStr:'<p class="p1">您已领取1111元购房基金！！！已发放至您手机号，请注意查收。</p>',repeatStr:"",yanErrorText:"请输入正确的验证码"}})},judgeChou:function(e){var t=this;$.ajax({type:"POST",url:"http://webapi.zeju.com/liuzi/hd_shoppingday_auth",data:{city_name:e.city_name,zjfrom:e.zjfrom,phone:e.phone},success:function(n){if(200==n.status)if(n.data.usable_count>0){var a=$("#zhuan_yuan_m").attr("data-num");$("#wrap").Turntable({oPointer:"#zhuan_zhi_m",oTurntable:"#zhuan_yuan_m",cat:40,temp:a,time:8},function(n){t.setJiangNum(e,n)})}else $(".shengyu").html("您最高抽中"+n.data.lottery_money+"元，还剩"+n.data.usable_count+"次"),t.alertJiang(n.data.lottery_money);else t.alertChoujiang(t.hd_name)}})},alertJiang:function(e){var t={phone:getCookie("zj_tow11_phone"),url:window.location.origin+window.location.pathname};"m"==this.tgsb&&($(".message").css({height:window.innerHeight+"px",width:window.innerWidth+"px"}).show(),window.scrollTo(0,0),$("body").on("touchmove",function(e){e.preventDefault},!1),$("#liuzi2").hide(),$("#box_alert,#statusId_info").css("display","block"),$("#money").html(e),this.newErweima(t))},baseJia:function(e,t){var n=new Base64;return t?n.encode(e):n.decode(e)},newErweima:function(e){var t=this.baseJia(e.phone,!0);$("#erweima_id").html(""),$("#erweima_id").qrcode({render:"canvas",text:e.url+"?refcode="+t,width:"140",height:"140",background:"#ffffff",foreground:"#000000",src:"/hd/template4/assets/images/logo.png"})},setJiangNum:function(e,t){var n=this;$.ajax({type:"POST",url:"http://webapi.zeju.com/liuzi/hd_shoppingday_yj",data:{city_name:e.city_name,zjfrom:e.zjfrom,phone:e.phone,lottery_type:{111:1,222:2,555:3}[t]},success:function(e){n.alertJiang(e.data.current_lottery),$(".shengyu").html("您最高抽中"+e.data.lottery_money+"元，还剩"+e.data.usable_count+"次")}})},itmeTab:function(){var e=this,t={bj:"http://mois.suning.com/signUpTemplet/sendRedirect.do?activityCode=7363128495&storeType=2&storeCode=10000701",cc:"http://res.m.suning.com/project/zhaoji/activiteDetails_1.html?activityCode=1450333594&storeType=2&storeCode=10001725",tj:"http://mois.suning.com/signUpTemplet/sendRedirect.do?activityCode=8217469660&storeType=2&storeCode=10000887",cs:"http://mois.suning.com/signUpTemplet/sendRedirect.do?activityCode=2162075837&storeType=2&storeCode=10005020",suzhou:"http://mois.suning.com/signUpTemplet/sendRedirect.do?activityCode=7436942000&storeType=2&storeCode=10028764"};e.renderPage({city_name:"bj"}),$("#city_box").on("click","li",function(){$(this).addClass("on").siblings().removeClass("on"),e.renderPage({city_name:$(this).attr("indexId")});var n=$(this).attr("indexId");$(".suning a").attr("href",t[n]),$(".suning img").attr("src","assets/images/m_"+n+".jpg")})},getQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);try{return decodeURI(n[2])}catch(e){try{return $URL.decode(n[2])}catch(e){return null}}},fieldUrl:function(){var e=window.location.pathname.split("/");return"hd"==e[1]?"bj":e[1]},liuzi:function(e,t,n){$(".wrap").Liuzi({yanBtnColor:"yanzm_btncolor",huodongUrl:"http://webapi.zeju.com/liuzi/hd_shoppingday_hb",tgsb:"m",cityName:t,yanzmText:"获取",layoutType:0,hd_alertArr:{succeedStr:'<p class="p1">您已领取1111元购房基金！！！已发放至您手机号，请注意查收。</p>',repeatStr:'<p class="p1">您已领取1111元购房基金！！！已发放至您手机号，请注意查收。</p>',expireStr:'<p class="p1">您来晚一步,红包已领完了。</p>'}})},renderPage:function(e){var t=this,n=e.city_name;$.ajax({type:"GET",url:"http://webapi.zeju.com/loupans/shoppingday",data:{city_name:n},success:function(e){if("fail"==e.message)t.failData(n,t.tgsb);else if("ok"==e.message){var a=e.data;t.succeed_m_page(a,t.getZjfrom(),n),t.imPage("m",n),t.liuzi(t.tgsb,n)}}})},failData:function(e,t){var n=3;setInterval(function(){var a='<img src="/hd/assets/images/404.png"/><span><b>'+n+"</b>秒后跳转到首页...</span>";$("#body").html(a).addClass("body404"),0==--n&&(window.location.href="pc"==t?"http://"+e+".zeju.com/index":"http://m.zeju.com/"+e),$("#html").css("opacity","1")},1e3)},succeed_m_page:function(e,t,n){var a="";$.each(e,function(e,i){a+='<dl class="list">\n              <dt>\n                <a href="http://m.zeju.com/'+n+"/loupan/loupan_detail/"+i.item_id+'" style="background-image:url(http://imgs.zeju.cn'+i.cover_pic+')"></a>',"在售"==i.salse_status?a+='<span class="state">【在售】</span>':"待售"==i.salse_status?a+='<span class="state">【待售】</span>':"售罄"==i.salse_status?a+='<span class="state">【售罄】</span>':"热销"==i.salse_status&&(a+='<span class="state">【热销】</span>'),null==i.price_type||0==i.current_average_price||null==i.current_average_price?a+='<p class="price"><span>价格 - 暂无</span>':4==i.price_type?a+="<p><span>总价 <b>"+i.current_average_price+"</b> 元／套</span>":a+="<p><span>均价 <b>"+i.current_average_price+"</b> 元／m²</span>",a+="<time>("+i.current_update_date+")</time>",a+='</p>\n                  </dt>\n                  <dd class="text">\n                    <p class="title">'+i.item_name+'</p>\n                    <p class="address">售楼地址：'+i.detail_addres+'</p>\n                    <p class="label_title">'+i.current_lables+"</p>",void 0!=i.ext_phone&&null!=i.ext_phone?a+='<p class="phone"><a href="tel:4006561188,'+(i.ext_phone+t)+'">':a+='<p class="phone"><a href="tel:4006561188,0">',a+='<img src="assets/images/rexian.png"></a></p>\n                  </dd>\n              </dl>'}),$("#loupan_cont").html(a)},alertInfo:function(){$("#activeRules").click(function(){$(".activeRuleClose").show()}),$(".activeRuleClose").click(function(){$(this).hide()}),$(".infoClose").click(function(){$(".message").hide(),$("body").off("touchmove")})},imPage:function(e,t){setTimeout(function(){$("#html").css("opacity","1")},100),"pc"==e?($("#zixun").on("click",function(){var e=$('<iframe class="iframe" id="iframe" src="/hd/im.html?city='+t+'"></iframe>');$("#wrap").after(e),$("#iframe").show(),$("#guan_iframe").show()}),$("#guan_iframe").on("click",function(){$("#iframe").hide(),$("#guan_iframe").hide()})):$("#online").attr("href","http://m.zeju.com/m/index.html?city_name="+t).show()},getZjfrom:function(){var e=null!=this.getQueryString("zjfrom")?this.getQueryString("zjfrom"):getCookie("zjfrom");return null!=e&&""!=e?e<10&&(e="0"+e):e="00",e},endTime:function(){var e=this;$.ajax({type:"GET",url:"http://webapi.zeju.com/hd_templates/hd_shoppingday_flag",async:!1,success:function(t){200==t.status?(e.end_flag=t.data.end_flag,e.end_flag||$("#activeRuleClose").html('<div class="daoqi">活动已结束,请继续关注我们后续的活动！</div>').css("display","block")):e.end_flag=!0}})},tiXingText:function(){return'\n                  <div class="box_main box_main2" id="box_main">\n                  <header class="boxM_title"><b class="guan" id="alert_guan"></b></header>\n                  <div class="boxM_text2">\n                    <div class="erweima_id" style="font-size:16px;width:100%;margin:0 0 20px;">活动已结束,请继续关注我们后续的活动！</div>\n                  </div>\n                </div>'},footerBtn:function(){var e=this;$("#hd_btn").on("click",function(t){if(e.endTime(),!e.end_flag)return $("#phone_error").html(""),$("#name_error").html(""),$("#yan_error").html(""),!1})}},$.fn.extend({Public:function(e){return new t(n,e)}})}(window);