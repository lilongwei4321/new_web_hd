"use strict";!function(t){function e(t,e){var n={tgsb:"pc",imgUrl:"_pc",data:[],alertAsync:!1};for(var a in e)n[a]=e[a];this.tgsb=n.tgsb,this.imgUrl=n.imgUrl,this.city_name="",this.data=n.data,this.alertAsync=n.alertAsync,this.zjfrom=null,this.end_flag=!0,this.cityNameobj={bj:"北京",tj:"天津",cc:"长春",suzhou:"苏州",cs:"长沙"},this.zhuanDong=!0,this.init()}var n=this;e.prototype={init:function(){this.city_name=null!=this.getQueryString("city")?this.getQueryString("city"):"bj",this.hd_name=this.fieldUrl(),this.switchCity(this.city_name),this.clickChouBtn(this.city_name),this.quoteLiuzi_footer(this.tgsb,this.city_name,this.hd_name),this.imPage(this.tgsb,this.cityNameobj[this.city_name]),this.footerBtn()},getQueryString:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(e);try{return decodeURI(n[2])}catch(t){try{return $URL.decode(n[2])}catch(t){return null}}},fieldUrl:function(){var t=window.location.pathname.split("/");return"hd"==t[1]?"bj":t[1]},switchCity:function(t){var e=this;this.renderPage(t),$("#city_nav").on("click","a",function(){var t=$(this).attr("data-id");$(this).addClass("on").siblings().removeClass("on"),e.renderPage(t),e.imPage(e.tgsb,e.cityNameobj[t])})},renderPage:function(t){var e=this;$("#guangao_box_a").attr("href",{cs:"http://mois.suning.com/signUpTemplet/sendRedirect.do?activityCode=2162075837&storeType=2&storeCode=10005020",cc:"http://res.m.suning.com/project/zhaoji/activiteDetails_1.html?activityCode=1450333594&storeType=2&storeCode=10001725",suzhou:"http://mois.suning.com/signUpTemplet/sendRedirect.do?activityCode=7436942000&storeType=2&storeCode=10028764",tj:"http://mois.suning.com/signUpTemplet/sendRedirect.do?activityCode=8217469660&storeType=2&storeCode=10000887",bj:"http://mois.suning.com/signUpTemplet/sendRedirect.do?activityCode=7363128495&storeType=2&storeCode=10000701"}[t]).find("img").attr("src","assets/images/"+t+"_pc.jpg"),$.ajax({type:"GET",url:"http://webapi.zeju.com/loupans/shoppingday",data:{city_name:t,zjfrom:e.getZjfrom()},success:function(n){200==n.status?e.clearHtml(n.data,t,e.getZjfrom()):e.failData(t,e.tgsb)}})},clearHtml:function(t,e,n){var a="";$.each(t,function(i,s){if(i%4==0&&(a+="<section>"),a+="\t<dl>\n            <dt>"+s.item_name+'</dt>\n            <dd>\n              <a href="http://'+e+".zeju.com/loupan/"+s.item_spell+"/"+s.item_id+'.html"  target="_blank" style="background-image:url(http://imgs.zeju.cn'+s.cover_pic+')">\n              </a>\n              <p class="price">',4==s.price_type?a+="<span>均价 <b>"+s.current_average_price+"</b> 元／套</span>":""!=s.current_average_price?a+="<span>均价 <b>"+s.current_average_price+"</b> 元／㎡</span>":a+="<b>暂无价格       </b>",a+="<time>（"+s.current_update_date+")</time></p>",void 0!=s.ext_phone&&null!=s.ext_phone?a+='<p class="phone"><b>售楼电话：</b><span>400-656-1188 转 '+s.ext_phone+n+"</span></p>":a+='<p class="phone"><b>售楼电话：</b><span>400-656-1188 转 0</span></p>',a+='<p class="dizhi duo"><b>售楼地址：</b><span>'+s.detail_addres+'</span></p>\n                    <p class="liyou">\n                      <a href="http://'+e+".zeju.com/loupan/"+s.item_spell+"/"+s.item_id+'.html"  target="_blank">\n                        <span>'+s.current_lables+"</span>\n                      </a>\n                    </p>\n                  </dd>\n                </dl>",t.length%4!=0&&i+1==t.length/4*4)for(var o=4*Math.ceil(t.length/4)-(i+1),r=0;r<o;r++)a+='<dl style="background:transparent"><dd></dd></dl>';i%4==3&&(a+="</section>")}),$("#loupan_box").html(a)},clickChouBtn:function(t){var e=this;$("#zhuan_zhi_pc").on("click",function(){if(e.endTime(),!e.end_flag)return!1;var n=getCookie("zj_tow11_phone");null!=n?e.judgeChou({city_name:t,zjfrom:e.getZjfrom(),phone:n}):(e.quoteAlert(e.tgsb,t,e.hd_name),$("#box_alert").css("display","block"))})},judgeChou:function(t){var e=this;if(!e.zhuanDong)return!1;e.zhuanDong=!1,$.ajax({type:"POST",url:"http://webapi.zeju.com/liuzi/hd_shoppingday_auth",data:{city_name:t.city_name,zjfrom:t.zjfrom,phone:t.phone},success:function(n){if(200==n.status)if(n.data.usable_count>0){var a=$("#zhuan_yuan_pc").attr("data-num");$("#seascape_wrap").Turntable({oPointer:"#zhuan_zhi_pc",oTurntable:"#zhuan_yuan_pc",cat:40,temp:a,time:8},function(n){e.setJiangNum(t,n)})}else e.alertJiang(n.data);else{var i=e.alertHtml(!1,"",t.city_name);"pc"==e.tgsb&&$("#seascape_wrap").fromAlerts({formAsync:!0,cont:i}),$("#box_alert").css("display","block")}}})},quoteAlert:function(t,e,n){var a=this.alertHtml(!1,"",e);"pc"==t&&($("#seascape_wrap").fromAlerts({formAsync:!0,cont:a}),this.quoteLiuzi_alert(t,e,n))},alertJiang:function(t){var e={phone:getCookie("zj_tow11_phone"),url:window.location.origin+window.location.pathname},n=this.alertHtml(!0,t);"pc"==this.tgsb&&($("#seascape_wrap").fromAlerts({formAsync:!0,cont:n}),this.newErweima(e)),$("#box_alert").css("display","block"),this.zhuanDong=!0},newErweima:function(t){var e=this.baseJia(t.phone,!0);$("#erweima_id").qrcode({render:"canvas",text:t.url+"?refcode="+e,width:"140",height:"140",background:"#ffffff",foreground:"#000000",src:"/hd/template4/assets/images/logo.png"})},baseJia:function(t,e){var n=new Base64;return e?n.encode(t):n.decode(t)},alertHtml:function(t,e,n){var a="";return a+=t?'\n            <div class="box_main box_main2" id="box_main">\n              <header class="boxM_title"><b class="guan" id="alert_guan"></b></header>\n              <div class="boxM_text2">\n                <h4>恭喜您抽取'+e.current_lottery+'元购房定金</h4>\n                <p>（已发放至您手机号，请注意查收）</p>\n                <div id="erweima_id" class="erweima_id"></div>\n                <p>手机微信扫一扫将活动链接分享给好友<br>报名即可增加抽奖机会。（最多获取5次抽奖机会）</p>\n                <p class="jihui">您最高抽中<b>'+e.lottery_money+"元，</b>还剩<b>"+e.usable_count+"</b>次机会</p>\n              </div>\n            </div>":'<div class="box_main box_main1" id="box_main">\n              <header class="boxM_title"><span>填写信息参与抽奖</span><b class="guan" id="alert_guan"></b></header>\n              <div class="boxM_text">\n                <p>\n                  <input type="text" placeholder="怎么称呼您" id="al_hd_name" maxlength="16">\n                </p>\n                <p>\n                  <input type="text" placeholder="请输入您的手机号" id="al_hd_phone" maxlength="11">\n                </p>\n                <p class="yan">\n                  <input type="text" placeholder="请输入验证码" class="pop-input1" id="al_hd_yanzm" maxlength="4">\n                  <input type="button" class="cod_btn"  value="获取验证码" id="al_hd_yanzmBtn" disabled="disabled">\n                </p>\n                <div class="city">\n                  <span>城市</span>\n                  <div id="select_city">\n                    <p data-id="'+n+'">长春</p>\n                    <ul>\n                      <li data-id="bj">北京</li>\n                      <li data-id="cc">长春</li>\n                      <li data-id="tj">天津</li>\n                      <li data-id="cs">长沙</li>\n                      <li data-id="suzhou">苏州</li>\n                    </ul>\n                  </div>\n                </div>\n                <p id="al_user_error" class="user_error"></p>\n                <p class="last_p">\n                  <span class="box_alertBtn" id="al_hd_btn">立即领取抽奖机会</span>\n                </p>\n              </div>\n            </div>'},quoteLiuzi_footer:function(t,e,n){$("#seascape_wrap").Liuzi({cityName:e,huodongUrl:"http://webapi.zeju.com/liuzi/hd_shoppingday_hb",hd_name:n,yanBtnColor:"yanzm_btncolor",clue_type_id:"4",tgsb:t,yanzmText:"获取",layoutType:0,huidiao:!0,hd_alertArr:{repeatStr:"您已领取1111元购房基金！！！已发放至您手机号，请注意查收。",succeedStr:"您已领取1111元购房基金！！！已发放至您手机号，请注意查收。",expireStr:"您来晚一步,红包已领完了。"}})},quoteLiuzi_alert:function(t,e,n){var a="";null!=this.getQueryString("refcode")&&(a=this.baseJia(this.getQueryString("refcode"),!1)),$("#seascape_wrap").Liuzi({cityName:e,nameId:"#al_hd_name",phoneId:"#al_hd_phone",yanzmId:"#al_hd_yanzm",yanzmBtn:"#al_hd_yanzmBtn",hdBtn:"#al_hd_btn",publicError:"#al_user_error",huodongUrl:"http://webapi.zeju.com/liuzi/hd_shoppingday_liuzi",hd_name:n,yanBtnColor:"yanzm_btncolor",clue_type_id:"4",tgsb:t,yanzmText:"获取验证码",layoutType:4,huidiao:!0,refcode:a,hd_alertArr:{nameErrorText:"请输入正确称呼！",phoneErrorText:"请输入正确的手机号！",yanErrorText:"请输入正确的验证码！",repeatStr:"",succeedStr:""}},function(t){t.async&&(setCookie("zj_tow11_phone",t.phone),$("#box_alert").css("display","none"))})},setJiangNum:function(t,e){var n=this;$.ajax({type:"POST",url:"http://webapi.zeju.com/liuzi/hd_shoppingday_yj",data:{city_name:t.city_name,zjfrom:t.zjfrom,phone:t.phone,lottery_type:{111:1,222:2,555:3}[e]},success:function(t){200==t.status&&(n.alertJiang(t.data),n.zhuanDong=!0)}})},failData:function(t,e){var n=3;setInterval(function(){var a='<img src="/hd/assets/images/404.png"/><span><b>'+n+"</b>秒后跳转到首页...</span>";$("#body").html(a).addClass("body404"),$("#html").css("background","#fff"),0==--n&&(window.location.href="pc"==e?"http://"+t+".zeju.com/index":"http://m.zeju.com/"+t),$("#html").css("opacity","1")},1e3)},getZjfrom:function(){var t=null!=this.getQueryString("zjfrom")?this.getQueryString("zjfrom"):getCookie("zjfrom");return null!=t&&""!=t?t<10&&(t="0"+t):t="16",t},imPage:function(t,e){"pc"==t?($("#zixun").on("click",function(){var t=$('<iframe class="iframe" id="iframe" src="/hd/im.html?city='+e+'"></iframe>');$("#iframe_box").html(t),$("#iframe_box").show(),$("#guan_iframe").show()}),$("#guan_iframe").on("click",function(){$("#iframe_box").hide(),$("#guan_iframe").hide()})):$("#online").attr("href","http://m.zeju.com/m/index.html?city_name="+e).show()},endTime:function(){var t=this;$.ajax({type:"GET",url:"http://webapi.zeju.com/hd_templates/hd_shoppingday_flag",async:!1,success:function(e){if(200==e.status){if(t.end_flag=e.data.end_flag,!t.end_flag){var n=t.tiXingText();$("#seascape_wrap").fromAlerts({formAsync:!1,cont:n}),$("#box_alert").css("display","block")}}else t.end_flag=!0}})},tiXingText:function(){return'\n                <div class="box_main box_main2" id="box_main">\n                <header class="boxM_title"><b class="guan" id="alert_guan"></b></header>\n                <div class="boxM_text2">\n                  <div class="erweima_id" style="font-size:16px;width:100%;margin:0 0 20px;">活动已结束,请继续关注我们后续的活动！</div>\n                </div>\n              </div>'},footerBtn:function(){var t=this;$("#hd_btn").on("click",function(e){if(t.endTime(),!t.end_flag)return $("#phone_error").html(""),$("#name_error").html(""),$("#yan_error").html(""),!1})}},$.fn.extend({Public:function(t){return new e(n,t)}})}(window);