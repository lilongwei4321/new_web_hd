function buildEmoji(e){for(var t=/\[([^\]\[]*)\]/g,i=e.match(t)||[],n=0,s=i.length;n<s;++n)emoji[i[n]]&&(e=e.replace(i[n],'<img class="emoji" src="/hd/assets/images/emoji/'+emoji[i[n]].file+'" />'));return e}function CEmojiEngine(e,t){t=t||{},this.__init(e,t)}function guwen_inajax(e,t,i,n,s,o){$.ajax({type:"POST",url:"http://webapi.zeju.com/neteaseim/advisor",data:{advisor_choosed:e,advisor_id:t,logined:i,login_phone:n,city_name:s,im_customer_id:userUID,ids:o,pc:"1"},dataType:"json",async:!1,success:function(e){if(0==e.status&&"succeed"==e.message){var e=e.data;setCookie("guwen_data",guwen_data=e.advisor_info.accid),$(".wrapper").css({display:"block"})}},error:function(e){console.log(e,"cuo")}})}function user_inajax(e,t){$.ajax({type:"POST",url:"http://webapi.zeju.com/neteaseim/customer",data:{logined:e,login_phone:t},dataType:"json",async:!1,success:function(e){if(0==e.status&&"succeed"==e.message){var e=e.data;setCookie("accid",userUID=String(e.customer_info.accid)),setCookie("usertoken",e.customer_info.token),Login.requestLogin(String(e.customer_info.accid),String(e.customer_info.token)),yunXin=new YX(userUID),$(".wrapper").css({display:"block"})}},error:function(e){console.log(e,"cuo")}})}function im_liuzi(e,t,i,n,s){$.ajax({type:"POST",url:"http://bj.zeju.com/im_liuzi.json",data:{accid:e,page_name:t,advisor_id:i,loupan_id:n,loupan_name:s},dataType:"json",async:!1,success:function(e){0==e.status&&"succeed"==e.message&&console.log("success")},error:function(e){console.log(e,"sorry")}})}function setCookie(e,t){var i=new Date;i.setTime(i.getTime()+864e5),document.cookie=e+"="+escape(t)+";expires="+i.toGMTString()}function readCookie(e){var t,i=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(i))?unescape(t[2]):null}function delCookie(e){var t=readCookie(e);null!=t&&(document.cookie=e+"="+t+";expires="+new Date(0).toGMTString())}function buildSessionMsg(e){var t="p2p"!=e.scene?(e.from===userUID?"你":getNick(e.from))+":":"",i=e.type;if(!/text|image|file|audio|video|geo|custom|tip|notification/i.test(i))return"";switch(i){case"text":t=buildEmoji(t+=_$escape(e.text));break;case"image":t+="[图片]";break;case"file":/exe|bat/i.test(e.file.ext)?t+="[非法文件，已被本站拦截]":t+="[文件]";break;case"audio":t+="[语音]";break;case"video":t+="[视频]";break;case"geo":t+="[位置]";break;case"tip":t="[提醒消息]";break;case"custom":var n=JSON.parse(e.content);1===n.type?t+="[猜拳]":2===n.type?t+="[阅后即焚]":3===n.type?t+="[贴图]":4===n.type?t+="[白板]":t+="[自定义消息]";break;case"notification":break;default:t+="[未知消息类型]"}return"fail"===e.status&&(t='<i class="icon icon-error"></i>'+t),t}function getMessage(e){var t="",i=e.file?_$escape(e.file.url):"",n=e.from!==userUID?"收到":"发送";switch(e.type){case"text":var s=/(http:\/\/[\w.\/]+)(?![^<]+>)/gi;t="<div class='f-maxWid'>"+(t=buildEmoji(t=(t=_$escape(e.text)).replace(s,"<a href='$1' target='_blank' style='display:block;margin-bottom:5px;'>$1</a>")))+"</div>";break;case"image":-1===e.status?t="<p>["+e.message.message+"]</p>":(e.file.url=_$escape(e.file.url),t='<a href="'+e.file.url+'?imageView" target="_blank"><img onload="loadImg()" data-src="'+e.file.url+'" src="'+e.file.url+'?imageView&thumbnail=200x0&quality=85"/></a>');break;case"file":-1===e.status?t="<p>["+e.message.message+"]</p>":/png|jpg|bmp|jpeg|gif/i.test(e.file.ext)?(e.file.url=_$escape(e.file.url),t='<a class="f-maxWid" href="'+e.file.url+'?imageView" target="_blank"><img data-src="'+e.file.url+'" src="'+e.file.url+'?imageView&thumbnail=200x0&quality=85"/></a>'):t=/exe|bat/i.test(e.file.ext)?"<p>[非法文件，已被本站拦截]</p>":'<a href="'+(i+=e.file?"?download="+encodeURI(_$escape(e.file.name)):"")+'" target="_blank" class="download-file f-maxWid"><span class="icon icon-file2"></span>'+_$escape(e.file.name)+"</a>";break;case"tip":t=e.tip;break;case"video":t='<video src= "'+i+'" controls>您的浏览器不支持 video 标签。</video>';break;case"audio":t=window.Audio?e.from===userUID&&e.from!==e.to?'<div class="u-audio j-mbox right"> <a href="javascript:;" class="j-play playAudio" data-dur="'+e.file.dur+'"  data-src="'+i+'">点击播放</a><b class="j-duration">'+Math.floor(e.file.dur/1e3)+'"</b><span class="u-icn u-icn-play" title="播放音频"></span></div>':'<div class="u-audio j-mbox left"> <a href="javascript:;" class="j-play playAudio" data-dur="'+e.file.dur+'"  data-src="'+i+'">点击播放</a><b class="j-duration">'+Math.floor(e.file.dur/1e3)+'"</b><span class="u-icn u-icn-play" title="播放音频"></span></div>':'<a href="'+i+'" target="_blank" class="download-file"><span class="icon icon-file2"></span>['+n+"一条语音消息]</a>";break;case"geo":t=n+"一条[地理位置]消息";break;case"custom":var o=JSON.parse(e.content);t=1===o.type?n+"一条[猜拳]消息,请到手机或电脑客户端查看":2===o.type?n+"一条[阅后即焚]消息,请到手机或电脑客户端查看":3===o.type?'<img class="chartlet" onload="loadImg()" src="./images/'+_$escape(o.data.catalog)+"/"+_$escape(o.data.chartlet)+'.png">':4==o.type?n+"一条[白板]消息,请到手机或电脑客户端查看":n+"一条[自定义]消息，请到手机或电脑客户端查看";break;default:if(e&&e.attach&&void 0!==e.attach.netcallType){e.attach.netcallType,Netcall.NETCALL_TYPE_VIDEO;e.attach&&"netcallBill"===e.attach.type?t="通话"+("in"===e.flow?"接听":"拨打")+"时长 "+getNetcallDurationText(e.attach.duration):e.attach&&"netcallMiss"===e.attach.type&&(t="未接听")}else t=n+"一条[未知消息类型]消息"}return t}function buildSender(e){var t="";return e.from===e.to?t="Web"===e.fromClientType?"me":"you":(t=e.from!==userUID||e.fromClientType?"you":"me",e.from===userUID&&e.to!=userUID&&(t="me")),t}function getNetcallDurationText(e){var t,i="";return e>=3600&&(i+=("00"+parseInt(e/3600)).slice(-2)+" : "),i+=e>=60?("00"+parseInt(e%3600/60)).slice(-2)+" : ":"00 : ",t=parseInt(e%3600%60),i+=("00"+t).slice(-2)}function removeChatVernier(e){e==$("li.active").attr("data-account")&&$("#chatVernier span").css("top","-20px")}function loadImg(){$("#chatContent").scrollTop(99999)}function getAvatar(e){return/^((http|https|ftp):\/\/)?(\w(\:\w)?@)?([0-9a-z_-]+\.)*?([a-z0-9-]+\.[a-z]{2,6}(\.[a-z]{2})?(\:[0-9]{2,6})?)((\/[^?#<>\/\\*":]*)+(\?[^#]*)?(#.*)?)?$/i.test(e)?e:"/hd/assets/images/customer-pic.png"}function getNick(e,t){var i=(t=t||yunXin.cache).getFriendAlias(e),n=t.getUserById(e);return i=i||(n&&n.nick?n.nick:e)}function getAllAccount(e){if(e){Array.isArray(e)||(e=[e]);for(var t=[],i=e.length-1;i>=0;i--)if(t.push(e[i].from),e[i].attach&&e[i].attach.accounts)for(var n=e[i].attach.accounts.length-1;n>=0;n--)t.push(e[i].attach.accounts[n]);return t}}var Cache=function(){var e=function(e){this.friendslist=[],this.personlist={},this.personSubscribes={},this.teamlist=[],this.teamMembers={},this.teamMap={},this.msgs={},this.sessions=[],this.blacklist=[],this.mutelist=[],this.sysMsgs=[],this.customSysMsgs=[],this.sysMsgCount=0};return e.prototype.getUserById=function(e){return!!this.personlist[e]&&this.personlist[e]},e.prototype.setPersonlist=function(e){for(var t,i=e.length-1;i>=0;i--)t=e[i],this.personlist[t.account]=t},e.prototype.updateAvatar=function(e){this.personlist[userUID].avatar=e},e.prototype.updatePersonlist=function(e){if(this.personlist[e.account])for(var t in e)this.personlist[e.account][t]=e[t];else this.personlist[e.account]=e},e.prototype.getPersonlist=function(){return this.personlist},e.prototype.setFriends=function(e){this.friendslist=e},e.prototype.getFriends=function(e){return this.friendslist},e.prototype.getFriendAlias=function(e){for(var t=this.friendslist.length-1;t>=0;t--)if(this.friendslist[t].account==e)return this.friendslist[t].alias||""},e.prototype.updateFriendAlias=function(e,t){for(var i=this.friendslist.length-1;i>=0;i--)if(this.friendslist[i].account==e)return void(this.friendslist[i].alias=t)},e.prototype.addFriend=function(e){this.isFriend(e.account)||this.friendslist.push(e)},e.prototype.removeFriend=function(e){for(var t=this.friendslist.length-1;t>=0;t--)this.friendslist[t].account==e&&this.friendslist.splice(t,1)},e.prototype.getFriendslist=function(){for(var e=[],t=0;t<this.friendslist.length;t++)e.push(this.getUserById(this.friendslist[t].account));return e},e.prototype.getFriendslistOnShow=function(){for(var e=[],t=0;t<this.friendslist.length;t++)this.inBlacklist(this.friendslist[t].account)||e.push(this.getUserById(this.friendslist[t].account));return e},e.prototype.isFriend=function(e){for(var t=this.friendslist.length-1;t>=0;t--)if(this.friendslist[t].account==e)return!0;return!1},e.prototype.setSessions=function(e){this.sessions=e},e.prototype.getSessions=function(){return this.sessions},e.prototype.findSession=function(e){for(var t=this.sessions.length-1;t>=0;t--)if(this.sessions[t].id===e)return this.sessions[t];return!1},e.prototype.addMsgs=function(e){var t;if($.isArray(e))for(var i=0;i<e.length;i++)"team"===e[i].scene?(t=e[i].to,this.msgs["team-"+t]||(this.msgs["team-"+t]=[]),this.msgs["team-"+t].push(e[i])):(t=e[i].from===userUID?e[i].to:e[i].from,this.msgs["p2p-"+t]||(this.msgs["p2p-"+t]=[]),this.msgs["p2p-"+t].push(e[i]));else this.addMsg(e)},e.prototype.addMsg=function(e){var t;"team"===e.scene?(t="team-"+e.to,this.msgs[t]||(this.msgs[t]=[]),this.msgs[t].push(e)):(t="p2p-"+(e.from===userUID?e.to:e.from),this.msgs[t]||(this.msgs[t]=[]),this.msgs[t].push(e));for(var i=0;i<this.sessions.length;i++)if(t===this.sessions[i]){this.sessions.splice(i,1);break}},e.prototype.addMsgsByReverse=function(e){for(var t,i=0;i<e.length;i++)"team"===e[i].scene?(t=e[i].to,this.msgs["team-"+t]||(this.msgs["team-"+t]=[]),this.msgs["team-"+t].unshift(e[i])):(t=e[i].from===userUID?e[i].to:e[i].from,this.msgs["p2p-"+t]||(this.msgs["p2p-"+t]=[]),this.msgs["p2p-"+t].unshift(e[i]))},e.prototype.findMsg=function(e,t){for(var i=this.msgs[e],n=i.length-1;n>=0;n--)if(i[n].idClient===t)return i[n];return!1},e.prototype.setMsg=function(e,t,i){for(var n=this.msgs[e],s=n.length-1;s>=0;s--)if(n[s].idClient===t)return n.splice(s,1),void n.push(i)},e.prototype.backoutMsg=function(e,t,i){var n=this.msgs[e];if(n){for(var s=n.length-1;s>=0;s--)if(n[s].idClient===t)return void(n[s]=i);this.msgs[e].push(i)}else this.msgs[e]=[i]},e.prototype.setSysMsgs=function(e){this.sysMsgs=e},e.prototype.getSysMsgs=function(e){return this.sysMsgs},e.prototype.addCustomSysMsgs=function(e){for(var t=0;t<e.length;t++)this.customSysMsgs.push(e[t])},e.prototype.deleteCustomSysMsgs=function(){this.customSysMsgs=[]},e.prototype.getCustomSysMsgs=function(e){return this.customSysMsgs},e.prototype.getSysMsgCount=function(e){return this.sysMsgCount},e.prototype.setSysMsgCount=function(e){this.sysMsgCount=e},e.prototype.addSysMsgCount=function(e){this.sysMsgCount=this.sysMsgCount+e},e.prototype.getMsgs=function(e){return this.msgs[e]?this.msgs[e]:[]},e.prototype.getMsgsByUser=function(e){return this.msgs[e]||[]},e.prototype.addOfflineMsgs=function(e){for(var t=e.length-1;t>=0;t--)/text|image|file|audio|video|geo|custom|notification/i.test(e[t].type)&&this.addMsgs(e[t])},e.prototype.setTeamList=function(e){for(var t,i=e.length-1;i>=0;i--)t=e[i],this.teamMap[t.teamId]=t;this.teamlist=e},e.prototype.addTeam=function(e){this.hasTeam(e.teamId)||(this.teamMap[e.teamId]=e,this.teamlist.push(e))},e.prototype.hasTeam=function(e){for(var t=this.teamlist.length-1;t>=0;t--)if(this.teamlist[t].teamId===e)return!0;return!1},e.prototype.getTeamlist=function(){return this.teamlist},e.prototype.getTeamMap=function(){return this.teamMap},e.prototype.addTeamMap=function(e){for(var t=e.length-1;t>=0;t--)item=e[t],this.teamMap[item.teamId]=item},e.prototype.getTeamById=function(e){return this.hasTeam(e)?this.teamMap[e]:null},e.prototype.getTeamMapById=function(e){return this.teamMap[e]||null},e.prototype.removeTeamById=function(e){for(var t in this.teamlist)if(this.teamlist[t].teamId===e){this.teamlist.splice(t,1);break}},e.prototype.updateTeam=function(e,t){for(var i in t)this.teamMap[e][i]=t[i];for(var n in this.teamlist)if(this.teamlist[n].teamId===e){for(var i in t)this.teamlist[n][i]=t[i];break}},e.prototype.setTeamMembers=function(e,t){this.teamMembers[e]=t},e.prototype.addTeamMembers=function(e,t){if(this.teamMembers[e])for(var i=t.length-1;i>=0;i--)this.teamMembers[e].members.push(t[i])},e.prototype.removeTeamMembers=function(e,t){var i,n=this.teamMembers[e];if(n)for(var s=t.length-1;s>=0;s--){i=t[s];for(var o=n.members.length-1;o>=0;o--)if(n.members[o].account===i){n.members.splice(o,1);break}}},e.prototype.getTeamMembers=function(e){return this.teamMembers[e]},e.prototype.getTeamMemberInfo=function(e,t){var i=this.teamMembers[t];if(i&&i.members)for(var n=i.members.length-1;n>=0;n--)if(i.members[n].account===e)return i.members[n];return!1},e.prototype.isTeamManager=function(e,t){var i=this.teamMembers[t];if(i)for(var n=i.members.length-1;n>=0;n--)if(i.members[n].account===e&&("owner"===i.members[n].type||"manager"===i.members[n].type))return!0;return!1},e.prototype.updateTeamMemberMute=function(e,t,i){var n=this.teamMembers[e];if(n)for(var s=n.members.length-1;s>=0;s--)if(n.members[s].account===t)return void(n.members[s].mute=i)},e.prototype.setMutelist=function(e){this.mutelist=e},e.prototype.getMutelist=function(e){return this.mutelist},e.prototype.inMutelist=function(e){for(var t=this.mutelist.length-1;t>=0;t--)if(this.mutelist[t].account==e)return!0;return!1},e.prototype.addToMutelist=function(e){this.mutelist.push(e)},e.prototype.removeFromMutelist=function(e){for(var t=this.mutelist.length-1;t>=0;t--)if(this.mutelist[t].account==e)return this.mutelist.splice(t,1),!0;return!1},e.prototype.setBlacklist=function(e){this.blacklist=e},e.prototype.getBlacklist=function(){return this.blacklist},e.prototype.inBlacklist=function(e){for(var t=this.blacklist.length-1;t>=0;t--)if(this.blacklist[t].account==e)return!0;return!1},e.prototype.addToBlacklist=function(e){this.blacklist.push(e)},e.prototype.removeFromBlacklist=function(e){for(var t=this.blacklist.length-1;t>=0;t--)if(this.blacklist[t].account==e)return this.blacklist.splice(t,1),!0;return!1},e.prototype.updatePersonSubscribe=function(e){if(e.account){var t=e.account;this.personSubscribes[t]=this.personSubscribes[t]||{},this.personSubscribes[t][e.type]={account:e.account,type:e.type,value:e.value,custom:e.custom,clientType:e.clientType,serverConfig:e.serverConfig,time:e.time,multiPortStatus:""};var i=this.personSubscribes[t][e.type];if(1==+e.type&&(1==+e.value||2==+e.value||3==+e.value||10001==+e.value)){var n=JSON.parse(i.serverConfig),s=0;if(i.multiPortStatus="",n.online&&(n.online.indexOf(4)>=0?(i.multiPortStatus="电脑",s=4):n.online.indexOf(2)>=0?(i.multiPortStatus="iOS",s=2):n.online.indexOf(1)>=0?(i.multiPortStatus="Android",s=1):n.online.indexOf(16)>=0&&(i.multiPortStatus="Web",s=16)),i.custom&&Object.keys(i.custom).length>0){var o=function(e,t){var i={0:"",1:"Wifi",2:"WWAN",3:"2G",4:"3G",5:"4G"},n={0:"在线",1:"忙碌",2:"离开"},s="",t=t||{};if(0!==e?t=t[e]:t[4]?(t=t[4],s="电脑"):t[2]?(t=t[2],s="iOS"):t[1]?(t=t[1],s="Android"):t[16]&&(t=t[16],s="Web"),t){if("number"==typeof(t=JSON.parse(t)).net_state){var o=i[t.net_state];o&&(s+="-"+o)}"number"==typeof t.online_state?s+=n[t.online_state]:s+="在线"}return s}(s,i.custom);""!==i.multiPortStatus&&""===o?i.multiPortStatus+="在线":i.multiPortStatus+=o}else 0!==s?i.multiPortStatus+="在线":i.multiPortStatus="离线"}return!0}return!1},e.prototype.getMultiPortStatus=function(e){return this.personSubscribes[e]&&this.personSubscribes[e][1]?this.personSubscribes[e][1].multiPortStatus:""},e.prototype.getPersonSubscribes=function(){return this.personSubscribes},e}();!function(){var e={test:{appkey:"fe416640c8e8a72734219e1847ad2547",url:"https://apptest.netease.im"},pre:{appkey:"45c6af3c98409b18a84451215d0bdd6e",url:"http://preapp.netease.im:8184"},online:{appkey:"aa85e0e6fa66e72d2592a40b406b3815",url:"https://webapi.zeju.com"},ceName:{appkey:"5fef706137b1f262d0a319cdd93fc501",url:"https://imapi.zeju.com"}};window.CONFIG=e.online,window.CONFIG.openSubscription=!0}();var emoji={"[大笑]":{file:"emoji_0.png"},"[可爱]":{file:"emoji_01.png"},"[色]":{file:"emoji_02.png"},"[嘘]":{file:"emoji_03.png"},"[亲]":{file:"emoji_04.png"},"[呆]":{file:"emoji_05.png"},"[口水]":{file:"emoji_06.png"},"[呲牙]":{file:"emoji_07.png"},"[鬼脸]":{file:"emoji_08.png"},"[害羞]":{file:"emoji_09.png"},"[偷笑]":{file:"emoji_10.png"},"[调皮]":{file:"emoji_11.png"},"[可怜]":{file:"emoji_12.png"},"[敲]":{file:"emoji_13.png"},"[惊讶]":{file:"emoji_14.png"},"[流感]":{file:"emoji_15.png"},"[委屈]":{file:"emoji_16.png"},"[流泪]":{file:"emoji_17.png"},"[嚎哭]":{file:"emoji_18.png"},"[惊恐]":{file:"emoji_19.png"},"[怒]":{file:"emoji_20.png"},"[酷]":{file:"emoji_21.png"},"[不说]":{file:"emoji_22.png"},"[鄙视]":{file:"emoji_23.png"},"[阿弥陀佛]":{file:"emoji_24.png"},"[奸笑]":{file:"emoji_25.png"},"[睡着]":{file:"emoji_26.png"},"[口罩]":{file:"emoji_27.png"},"[努力]":{file:"emoji_28.png"},"[抠鼻孔]":{file:"emoji_29.png"},"[疑问]":{file:"emoji_30.png"},"[怒骂]":{file:"emoji_31.png"},"[晕]":{file:"emoji_32.png"},"[呕吐]":{file:"emoji_33.png"},"[拜一拜]":{file:"emoji_160.png"},"[惊喜]":{file:"emoji_161.png"},"[流汗]":{file:"emoji_162.png"},"[卖萌]":{file:"emoji_163.png"},"[默契眨眼]":{file:"emoji_164.png"},"[烧香拜佛]":{file:"emoji_165.png"},"[晚安]":{file:"emoji_166.png"},"[强]":{file:"emoji_34.png"},"[弱]":{file:"emoji_35.png"},"[OK]":{file:"emoji_36.png"},"[拳头]":{file:"emoji_37.png"},"[胜利]":{file:"emoji_38.png"},"[鼓掌]":{file:"emoji_39.png"},"[握手]":{file:"emoji_200.png"},"[发怒]":{file:"emoji_40.png"},"[骷髅]":{file:"emoji_41.png"},"[便便]":{file:"emoji_42.png"},"[火]":{file:"emoji_43.png"},"[溜]":{file:"emoji_44.png"},"[爱心]":{file:"emoji_45.png"},"[心碎]":{file:"emoji_46.png"},"[钟情]":{file:"emoji_47.png"},"[唇]":{file:"emoji_48.png"},"[戒指]":{file:"emoji_49.png"},"[钻石]":{file:"emoji_50.png"},"[太阳]":{file:"emoji_51.png"},"[有时晴]":{file:"emoji_52.png"},"[多云]":{file:"emoji_53.png"}},emojiList={emoji:{"[大笑]":{file:"emoji_0.png"},"[可爱]":{file:"emoji_01.png"},"[色]":{file:"emoji_02.png"},"[嘘]":{file:"emoji_03.png"},"[亲]":{file:"emoji_04.png"},"[呆]":{file:"emoji_05.png"},"[口水]":{file:"emoji_06.png"},"[呲牙]":{file:"emoji_07.png"},"[鬼脸]":{file:"emoji_08.png"},"[害羞]":{file:"emoji_09.png"},"[偷笑]":{file:"emoji_10.png"},"[调皮]":{file:"emoji_11.png"},"[可怜]":{file:"emoji_12.png"},"[敲]":{file:"emoji_13.png"},"[惊讶]":{file:"emoji_14.png"},"[流感]":{file:"emoji_15.png"},"[委屈]":{file:"emoji_16.png"},"[流泪]":{file:"emoji_17.png"},"[嚎哭]":{file:"emoji_18.png"},"[惊恐]":{file:"emoji_19.png"},"[怒]":{file:"emoji_20.png"},"[酷]":{file:"emoji_21.png"},"[不说]":{file:"emoji_22.png"},"[鄙视]":{file:"emoji_23.png"},"[阿弥陀佛]":{file:"emoji_24.png"},"[奸笑]":{file:"emoji_25.png"},"[睡着]":{file:"emoji_26.png"},"[口罩]":{file:"emoji_27.png"},"[努力]":{file:"emoji_28.png"},"[抠鼻孔]":{file:"emoji_29.png"},"[疑问]":{file:"emoji_30.png"},"[怒骂]":{file:"emoji_31.png"},"[晕]":{file:"emoji_32.png"},"[呕吐]":{file:"emoji_33.png"},"[拜一拜]":{file:"emoji_160.png"},"[惊喜]":{file:"emoji_161.png"},"[流汗]":{file:"emoji_162.png"},"[卖萌]":{file:"emoji_163.png"},"[默契眨眼]":{file:"emoji_164.png"},"[烧香拜佛]":{file:"emoji_165.png"},"[晚安]":{file:"emoji_166.png"},"[强]":{file:"emoji_34.png"},"[弱]":{file:"emoji_35.png"},"[OK]":{file:"emoji_36.png"},"[拳头]":{file:"emoji_37.png"},"[胜利]":{file:"emoji_38.png"},"[鼓掌]":{file:"emoji_39.png"},"[握手]":{file:"emoji_200.png"},"[发怒]":{file:"emoji_40.png"},"[骷髅]":{file:"emoji_41.png"},"[便便]":{file:"emoji_42.png"},"[火]":{file:"emoji_43.png"},"[溜]":{file:"emoji_44.png"},"[爱心]":{file:"emoji_45.png"},"[心碎]":{file:"emoji_46.png"},"[钟情]":{file:"emoji_47.png"},"[唇]":{file:"emoji_48.png"},"[戒指]":{file:"emoji_49.png"},"[钻石]":{file:"emoji_50.png"},"[太阳]":{file:"emoji_51.png"},"[有时晴]":{file:"emoji_52.png"},"[多云]":{file:"emoji_53.png"}}};CEmojiEngine.prototype.__init=function(e,t){this._emojiList=t.emojiList||[],this._imgpath=t.imgpath,this._callback=t.callback||function(){},this.__initXGui(e,t),this.__renderChangeCol(),this._curEmojiType="emoji-emoji",this._curEmojiNode=document.getElementById("chn-emoji-emoji"),this.__renderPictureCol(),this.__bindEvent()},CEmojiEngine.prototype.__initXGui=function(e,t){this._parentNode=document.createElement("div"),this._parentNode.className="m-emoji-wrapper",this._width=t.width||300,this._height=t.height||200,this._parentNode.style.width=this._width+"px",this._parentNode.style.height="auto",this._lWidth=parseInt((this._width-25)/12)-20,this._hWidth=parseInt((this._width-25)/5)-20;var i=document.createElement("div");i.className="m-emoji-picCol",i.style.width=this._width+"px",i.style.height=this._height+"px",this._parentNode.appendChild(i),this._pictureColumn=document.createElement("ul"),this._pictureColumn.className="m-emoji-picCol-ul",this._pictureColumn.style.width=this._width-10+"px",this._pictureColumn.style.height="auto",i.appendChild(this._pictureColumn),(i=document.createElement("div")).className="m-emoji-chnCol",i.style.width=this._width+"px",i.style.height="auto",this._parentNode.appendChild(i),this._changeColumn=document.createElement("div"),this._changeColumn.className="m-emoji-chnCol-ul",this._changeColumn.style.width="auto",this._changeColumn.style.height="50px",this.tmpguan=document.createElement("b"),this.tmpguan.className="m-emoji-chnCol-guan",this.tmpguan.id="m-emoji-chnCol-guan",this._changeColumn.appendChild(this.tmpguan),i.appendChild(this._changeColumn),void 0!=e&&e.appendChild(this._parentNode)},CEmojiEngine.prototype.__renderChangeCol=function(){for(var e in this._emojiList){var t=this._emojiList[e];for(var i in t){var n=document.createElement("span");n.id="chn-emoji-"+e;var s=new Image;s.src="/hd/assets/images/"+t[i].file,n.appendChild(s),this._changeColumn.appendChild(n);break}"emoji"==e&&(n.className="f-sel")}},CEmojiEngine.prototype.__renderPictureCol=function(){if(this._pictureColumn.innerHTML="",/^emoji-/.test(this._curEmojiType)){var e=this._curEmojiType.replace("emoji-",""),t=this._emojiList[e];for(var i in t){var n=document.createElement("span");n.id="pic-emoji-"+i,n.style.width=this._lWidth+"px",n.style.height="auto";var s=new Image;s.src="/hd/assets/images/"+e+"/"+t[i].file,n.appendChild(s),this._pictureColumn.appendChild(n)}}},CEmojiEngine.prototype.__bindEvent=function(){var e=this;this._$addEvent(this._pictureColumn,"click",function(t){var i=e._$getElement(t);if(e._$stop(t),"img"==i.tagName.toLowerCase())i=i.parentNode;else if("span"!=i.tagName.toLowerCase())return;var n=i.id,s=/^pic-(\w+)-(.+)$/.exec(n),o=s[2];s=s[1];var r=e._curEmojiType;"emoji"==s?r=r.replace("emoji-",""):"pinup"==s&&(r=r.replace("pinup-",""));var a={type:s,category:r,emoji:o};e._callback instanceof Function&&(e._callback.call(this,a),e._$hide())}),this._$addEvent(this.tmpguan,"click",function(t){"b"==e._$getElement(t).tagName.toLowerCase()&&e._callback instanceof Function&&e._$hide()})},CEmojiEngine.prototype._$show=function(){this._curEmojiType="emoji-emoji",this._curEmojiNode=document.getElementById("chn-emoji-emoji"),this.__renderPictureCol();this._changeColumn.getElementsByTagName("span");var e=this;setTimeout(function(){e._parentNode.style.display="block"},20)},CEmojiEngine.prototype._$hide=function(){this._parentNode.style.display="none"},CEmojiEngine.prototype._$addEvent=function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)},CEmojiEngine.prototype._$stop=function(e){(e=e||window.event).stopPropogation?e.stopPropogation():e.cancelBubble=!0},CEmojiEngine.prototype._$getElement=function(e){return(e=e||window.event).target||e.srcElement};var SDKBridge=function(e,t){function i(e){e=e.msgs,this.cache.addMsgs(e);for(var t=0;t<e.length;t++)"p2p"===e[t].scene&&(this.person[e[t].from!==s?e[t].from:e[t].to]=!0)}var n=readCookie("sdktoken"),s=readCookie("uid");this.person={},this.team=[],this.person[s]=!0,this.controller=e,this.cache=t,window.nim=e.nim=this.nim=new SDK.NIM({appKey:CONFIG.appkey,account:s,token:n,onconnect:function(){$("errorNetwork").addClass("hide"),this.teamMemberDone=!1,this.sysMsgDone=!1,console&&console.log("连接成功")}.bind(this),onerror:function(e){console.log("错误信息"+e)}.bind(this),onwillreconnect:function(e){$("errorNetwork").removeClass("hide")}.bind(this),onloginportschange:function(e){console.log("当前登录帐号在其它端的状态发生改变了",e),this.controller.loginPorts(e)}.bind(this),onteams:function(e){var t=this.cache.getTeamlist();t=this.nim.mergeTeams(t,e),t=this.nim.cutTeams(t,e.invalid),this.cache.setTeamList(t)}.bind(this),syncTeamMembers:!1,onmsg:function(e){this.controller.doMsg(e)}.bind(this),onroamingmsgs:i.bind(this),onofflinemsgs:i.bind(this),syncSessionUnread:!0,onsessions:function(e){var t=this.cache.getSessions();this.cache.setSessions(this.nim.mergeSessions(t,e));for(var i=0;i<e.length;i++)if("p2p"===e[i].scene){var n=e[i].to;this.cache.isFriend(n),this.person[n]=!0}else if("team"===e[i].scene){this.team.push(e[i].to);var s=null;if(e[i].lastMsg&&(s=getAllAccount(e[i].lastMsg)),!s)continue;for(var o=s.length-1;o>=0;o--)this.person[s[o]]=!0}}.bind(this),onupdatesession:function(e){var t=e.id||"",i=this.cache.getSessions();this.cache.setSessions(this.nim.mergeSessions(i,e)),this.controller.buildSessions(t)}.bind(this),onsyncdone:function(){this.controller.initInfo(this.person,this.team)}.bind(this)})};SDKBridge.prototype.setCurrSession=function(e,t){this.nim.setCurrSession(e+"-"+t)},SDKBridge.prototype.sendTextMessage=function(e,t,i,n,s){n=!!n,this.nim.sendText({scene:e||"p2p",to:t,text:i,isLocal:n,done:s})},SDKBridge.prototype.getHistoryMsgs=function(e){this.nim.getHistoryMsgs(e)},SDKBridge.prototype.getLocalMsgs=function(e,t,i){t?this.nim.getLocalMsgs({sessionId:e,end:t,limit:200,done:i}):this.nim.getLocalMsgs({sessionId:e,limit:200,done:i})},SDKBridge.prototype.getLocalTeams=function(e,t){this.nim.getLocalTeams({teamIds:e,done:t})},SDKBridge.prototype.getLocalSysMsgs=function(e){this.nim.getLocalSysMsgs({done:e})},SDKBridge.prototype.deleteAllLocalSysMsgs=function(e){this.nim.deleteAllLocalSysMsgs({done:e})},SDKBridge.prototype.getUsers=function(e,t){var i=e.slice(0,150),n=e.slice(150),s=[],o=this,r=function(){o.nim.getUsers({accounts:i,done:function(e,o){e?t(e):(s=s.concat(o),n.length>0?(i=n.slice(0,150),n=n.slice(150),r()):t(e,s))}})};r()},SDKBridge.prototype.getUser=function(e,t){this.nim.getUser({account:e,done:t})},SDKBridge.prototype.updateMyInfo=function(e,t,i,n,s,o,r){this.nim.updateMyInfo({nick:e,gender:t,birth:i,tel:n,email:s,sign:o,done:r})},SDKBridge.prototype.updateMyAvatar=function(e,t){this.nim.updateMyInfo({avatar:e,done:t})},SDKBridge.prototype.updateFriend=function(e,t,i){this.nim.updateFriend({account:e,alias:t,done:i})},SDKBridge.prototype.sendMsgReceipt=function(e,t){this.nim.sendMsgReceipt({msg:e,done:t})},SDKBridge.prototype.resendMsg=function(e,t){this.nim.resendMsg({msg:e,done:t})};var Login={requestLogin:function(e,t){setCookie("uid",e.toLocaleLowerCase()),setCookie("sdktoken",t)},getBrowser:function(){var e={msie:!1,firefox:!1,opera:!1,safari:!1,chrome:!1,netscape:!1,appname:"unknown",version:0},t=window.navigator.userAgent.toLowerCase();return/(msie|firefox|opera|chrome|netscape)\D+(\d[\d.]*)/.test(t)?(e[RegExp.$1]=!0,e.appname=RegExp.$1,e.version=RegExp.$2):/version\D+(\d[\d.]*).*safari/.test(t)&&(e.safari=!0,e.appname="safari",e.version=RegExp.$2),e.appname+" "+e.version}},userUID=null,yunXin="",userUID="",guwen_data="",cityzhi=decodeURI(window.location.search.split("=")[1]);guwen_data=readCookie("guwen_data");var login_phone=null!=readCookie("login_phone")?readCookie("login_phone"):"",loupan_ids=null==readCookie("browse_items")?"":readCookie("browse_items"),guwenId="",city_name=null!=cityzhi?cityzhi:"杭州",advisor_async="0",logined_async=""!=login_phone?"1":"0";null==(userUID=""!=userUID?userUID:readCookie("accid"))?(user_inajax(logined_async,login_phone),guwen_inajax(advisor_async,guwenId,logined_async,login_phone,city_name,loupan_ids)):(""==yunXin&&(yunXin=new YX(userUID)),$(".wrapper").css({display:"block"})),im_liuzi(userUID,"右侧悬停",guwen_data,"","");var MD5=function(e){function t(e,t){return e<<t|e>>>32-t}function i(e,t){var i,n,s,o,r;return s=2147483648&e,o=2147483648&t,i=1073741824&e,n=1073741824&t,r=(1073741823&e)+(1073741823&t),i&n?2147483648^r^s^o:i|n?1073741824&r?3221225472^r^s^o:1073741824^r^s^o:r^s^o}function n(e,t,i){return e&t|~e&i}function s(e,t,i){return e&i|t&~i}function o(e,t,i){return e^t^i}function r(e,t,i){return t^(e|~i)}function a(e,s,o,r,a,l,c){return e=i(e,i(i(n(s,o,r),a),c)),i(t(e,l),s)}function l(e,n,o,r,a,l,c){return e=i(e,i(i(s(n,o,r),a),c)),i(t(e,l),n)}function c(e,n,s,r,a,l,c){return e=i(e,i(i(o(n,s,r),a),c)),i(t(e,l),n)}function p(e,n,s,o,a,l,c){return e=i(e,i(i(r(n,s,o),a),c)),i(t(e,l),n)}function u(e){var t,i="",n="";for(t=0;t<=3;t++)i+=(n="0"+(e>>>8*t&255).toString(16)).substr(n.length-2,2);return i}var m,f,g,h,d,y,_,v,j,b=Array();for(b=function(e){for(var t,i=e.length,n=i+8,s=16*((n-n%64)/64+1),o=Array(s-1),r=0,a=0;a<i;)r=a%4*8,o[t=(a-a%4)/4]=o[t]|e.charCodeAt(a)<<r,a++;return t=(a-a%4)/4,r=a%4*8,o[t]=o[t]|128<<r,o[s-2]=i<<3,o[s-1]=i>>>29,o}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t}(e)),y=1732584193,_=4023233417,v=2562383102,j=271733878,m=0;m<b.length;m+=16)f=y,g=_,h=v,d=j,_=p(_=p(_=p(_=p(_=c(_=c(_=c(_=c(_=l(_=l(_=l(_=l(_=a(_=a(_=a(_=a(_,v=a(v,j=a(j,y=a(y,_,v,j,b[m+0],7,3614090360),_,v,b[m+1],12,3905402710),y,_,b[m+2],17,606105819),j,y,b[m+3],22,3250441966),v=a(v,j=a(j,y=a(y,_,v,j,b[m+4],7,4118548399),_,v,b[m+5],12,1200080426),y,_,b[m+6],17,2821735955),j,y,b[m+7],22,4249261313),v=a(v,j=a(j,y=a(y,_,v,j,b[m+8],7,1770035416),_,v,b[m+9],12,2336552879),y,_,b[m+10],17,4294925233),j,y,b[m+11],22,2304563134),v=a(v,j=a(j,y=a(y,_,v,j,b[m+12],7,1804603682),_,v,b[m+13],12,4254626195),y,_,b[m+14],17,2792965006),j,y,b[m+15],22,1236535329),v=l(v,j=l(j,y=l(y,_,v,j,b[m+1],5,4129170786),_,v,b[m+6],9,3225465664),y,_,b[m+11],14,643717713),j,y,b[m+0],20,3921069994),v=l(v,j=l(j,y=l(y,_,v,j,b[m+5],5,3593408605),_,v,b[m+10],9,38016083),y,_,b[m+15],14,3634488961),j,y,b[m+4],20,3889429448),v=l(v,j=l(j,y=l(y,_,v,j,b[m+9],5,568446438),_,v,b[m+14],9,3275163606),y,_,b[m+3],14,4107603335),j,y,b[m+8],20,1163531501),v=l(v,j=l(j,y=l(y,_,v,j,b[m+13],5,2850285829),_,v,b[m+2],9,4243563512),y,_,b[m+7],14,1735328473),j,y,b[m+12],20,2368359562),v=c(v,j=c(j,y=c(y,_,v,j,b[m+5],4,4294588738),_,v,b[m+8],11,2272392833),y,_,b[m+11],16,1839030562),j,y,b[m+14],23,4259657740),v=c(v,j=c(j,y=c(y,_,v,j,b[m+1],4,2763975236),_,v,b[m+4],11,1272893353),y,_,b[m+7],16,4139469664),j,y,b[m+10],23,3200236656),v=c(v,j=c(j,y=c(y,_,v,j,b[m+13],4,681279174),_,v,b[m+0],11,3936430074),y,_,b[m+3],16,3572445317),j,y,b[m+6],23,76029189),v=c(v,j=c(j,y=c(y,_,v,j,b[m+9],4,3654602809),_,v,b[m+12],11,3873151461),y,_,b[m+15],16,530742520),j,y,b[m+2],23,3299628645),v=p(v,j=p(j,y=p(y,_,v,j,b[m+0],6,4096336452),_,v,b[m+7],10,1126891415),y,_,b[m+14],15,2878612391),j,y,b[m+5],21,4237533241),v=p(v,j=p(j,y=p(y,_,v,j,b[m+12],6,1700485571),_,v,b[m+3],10,2399980690),y,_,b[m+10],15,4293915773),j,y,b[m+1],21,2240044497),v=p(v,j=p(j,y=p(y,_,v,j,b[m+8],6,1873313359),_,v,b[m+15],10,4264355552),y,_,b[m+6],15,2734768916),j,y,b[m+13],21,1309151649),v=p(v,j=p(j,y=p(y,_,v,j,b[m+4],6,4149444226),_,v,b[m+11],10,3174756917),y,_,b[m+2],15,718787259),j,y,b[m+9],21,3951481745),y=i(y,f),_=i(_,g),v=i(v,h),j=i(j,d);return(u(y)+u(_)+u(v)+u(j)).toLowerCase()},appUI={buildChatContentUI:function(e,t){for(var i="",n=t.getMsgs(e),s=0,o=n.length;s<o;++s){var r=n[s],a=t.getUserById(r.from);r.attach&&void 0!==r.attach.netcallType&&"netcallBill"!==r.attach.type&&"netcallMiss"!==r.attach.type||(0==s?i+=this.makeTimeTag(transTime(r.time)):r.time-n[s-1].time>3e5&&(i+=this.makeTimeTag(transTime(r.time))),i+=this.makeChatContent(r,a))}return i},updateChatContentUI:function(e,t){var i=$("#chatContent .item").last(),n="",s=t.getUserById(e.from),o=e;return o.attach&&void 0!==o.attach.netcallType&&"netcallBill"!==o.attach.type&&"netcallMiss"!==o.attach.type?"":(0==i.length?n+=this.makeTimeTag(transTime(e.time)):e.time-parseInt(i.attr("data-time"))>3e5&&(n+=this.makeTimeTag(transTime(e.time))),n+=this.makeChatContent(e,s))},makeChatContent:function(e,t){var i=e.type,n=e.from,s=t.avatar,o="team"===e.scene&&n!==userUID;return"tip"===i?['<div data-time="'+e.time+'" data-id="'+e.idClient+'" id="'+e.idClient+'" data-idServer="'+e.idServer+'">','<p class="u-notice tc item '+(n==userUID&&e.idServer?"j-msgTip":"")+'" data-time="'+e.time+'" data-id="'+e.idClient+'" data-idServer="'+e.idServer+'"><span class="radius5px">'+getMessage(e)+"</span></p>","</div>"].join(""):['<div data-time="'+e.time+'" data-id="'+e.idClient+'" id="'+e.idClient+'" data-idServer="'+e.idServer+'" class="item item-'+buildSender(e)+'">','<img class="img j-img" src="'+getAvatar(s)+'" data-account="'+n+'"/>',o?'<p class="nick">'+getNick(n)+"</p>":"",'<div class="msg msg-text j-msg">','<div class="box">','<div class="cnt">',getMessage(e),"</div>","</div>","</div>","fail"===e.status?'<span class="error j-resend" data-session="'+e.sessionId+'" data-id="'+e.idClient+'"><i class="icon icon-error"></i>发送失败,点击重发</span>':"",'<span class="readMsg"><i></i>已读</span>',"</div>"].join("")},makeTimeTag:function(e){return'<p class="u-msgTime">- - - - -&nbsp;'+e+"&nbsp;- -- - -</p>"}};Function.prototype.bind||(Function.prototype.bind=function(){var e=this,t=Array.prototype.slice.call(arguments),i=t.shift();return function(){return e.apply(i,t.concat(Array.prototype.slice.call(arguments)))}});var _$encode=function(e,t){return t=""+t,e&&t?t.replace(e.r,function(t){var i=e[e.i?t:t.toLowerCase()];return null!=i?i:t}):t||""},_$escape=function(){var e=/<br\/?>$/,t={r:/\<|\>|\&|\r|\n|\s|\'|\"/g,"<":"&lt;",">":"&gt;","&":"&amp;"," ":"&nbsp;",'"':"&quot;","'":"&#39;","\n":"<br/>","\r":""};return function(i){return(i=_$encode(t,i)).replace(e,"<br/><br/>")}}();Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e},Array.prototype.each=function(e){e=e||Function.K;for(var t=[],i=Array.prototype.slice.call(arguments,1),n=0;n<this.length;n++){var s=e.apply(this,[this[n],n].concat(i));null!=s&&t.push(s)}return t},Array.prototype.contains=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return!0;return!1},Array.prototype.uniquelize=function(){for(var e=new Array,t=0;t<this.length;t++)e.contains(this[t])||e.push(this[t]);return e},Array.complement=function(e,t){return Array.minus(Array.union(e,t),Array.intersect(e,t))},Array.intersect=function(e,t){return e.uniquelize().each(function(e){return t.contains(e)?e:null})},Array.minus=function(e,t){return e.uniquelize().each(function(e){return t.contains(e)?null:e})},Array.union=function(e,t){return e.concat(t).uniquelize()};var transTime=function(){var e=function(e){e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e.setHours(0);var t=e.getTime();return e.setMonth(1),e.setDate(1),[t,e.getTime()]};return function(t){var i=e(new Date);return t>=i[0]?dateFormat(t,"HH:mm"):t<i[0]&&t>=i[1]?dateFormat(t,"MM-dd HH:mm"):dateFormat(t,"yyyy-MM-dd HH:mm")}}(),transTime2=function(){var e=function(e){e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e.setHours(0);var t=e.getTime();return e.setMonth(1),e.setDate(1),[t,e.getTime()]};return function(t){var i=e(new Date);return t>=i[0]?dateFormat(t,"HH:mm"):t>=i[0]-864e5?"昨天":t>=i[0]-1728e5?"前天":t>=i[0]-6048e5?"星期"+dateFormat(t,"w"):t>=i[1]?dateFormat(t,"MM-dd"):dateFormat(t,"yyyy-MM-dd")}}(),dateFormat=function(){var e={i:!0,r:/\byyyy|yy|MM|cM|eM|M|dd|d|HH|H|mm|ms|ss|m|s|w|ct|et\b/g},t=["上午","下午"],i=["A.M.","P.M."],n=["日","一","二","三","四","五","六"],s=["一","二","三","四","五","六","七","八","九","十","十一","十二"],o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"],r=function(e){return((e=parseInt(e)||0)<10?"0":"")+e},a=function(e){return e<12?0:1};return function(l,c,p){if(!l||!c)return"";l=new Date(l),e.yyyy=l.getFullYear(),e.yy=(""+e.yyyy).substr(2),e.M=l.getMonth()+1,e.MM=r(e.M),e.eM=o[e.M-1],e.cM=s[e.M-1],e.d=l.getDate(),e.dd=r(e.d),e.H=l.getHours(),e.HH=r(e.H),e.m=l.getMinutes(),e.mm=r(e.m),e.s=l.getSeconds(),e.ss=r(e.s),e.ms=l.getMilliseconds(),e.w=n[l.getDay()];var u=a(e.H);return e.ct=t[u],e.et=i[u],p&&(e.H=e.H%12),_$encode(e,c)}}();