"use strict";!function(t){function a(t,a){var i={tgsb:"pc",imgUrl:"_pc",data:[],alertAsync:!1};for(var n in a)i[n]=a[n];this.tgsb=i.tgsb,this.imgUrl=i.imgUrl,this.city_name="",this.type="",this.loupanId="",this.data=i.data,this.alertAsync=i.alertAsync,this.zjfrom=null,this.end_flag=!0,this.checkedData=[],this.cityNameobj={bj:"北京",tj:"天津",cc:"长春",suzhou:"苏州",cs:"长沙"},this.zhuanDong=!0,this.init()}var i=this;a.prototype={init:function(){this.city_name=null!=this.getQueryString("city")?this.getQueryString("city"):"cc",this.hd_name=this.fieldUrl(),this.switchCity(),this.clickChouBtn(this.city_name),this.quoteLiuzi_footer(this.tgsb,this.city_name,this.hd_name),this.userName(),this.clickToupiao()},getQueryString:function(t){var a=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(a);try{return decodeURI(i[2])}catch(t){try{return $URL.decode(i[2])}catch(t){return null}}},fieldUrl:function(){var t=window.location.pathname.split("/");return"hd"==t[1]?"2017ccndlppx":t[1]},userName:function(){null==getCookie("niandu_customer_id")&&$.ajax({type:"GET",url:"http://webapi.zeju.com/pingxuan/visitor",success:function(t){200==t.status&&setCookie("niandu_customer_id",t.data.visitor_id)}})},switchCity:function(){var t=this;this.renderPage(1,"loupan_box"),this.renderPage(5,"loupan_box2"),$("#city_nav").on("click","a",function(){var a=$(this).attr("data-id");$(this).addClass("on").siblings().removeClass("on"),t.renderPage(a,"loupan_box")}),$("#nian_nav").on("click","a",function(){var a=$(this).attr("data-id");$(this).addClass("on").siblings().removeClass("on"),t.renderPage(a,"loupan_box2")})},renderPage:function(t,a){var i=this;$.ajax({type:"GET",url:"http://webapi.zeju.com/loupans/cclppx",data:{type:t,visitor_id:getCookie("niandu_customer_id")},success:function(n){200==n.status?(i.clearHtml(n.data,a,t),$("#hd_phone").on("keyup",function(){11==$(this).val().length&&/^1[34578]\d{9}$/.test($(this).val())?$("#hd_yanzmBtn").addClass("yanzm_btncolor").attr({disabled:!1,style:""}):$("#hd_yanzmBtn").removeClass("yanzm_btncolor").attr({disabled:!0,style:""})})):i.failData("cc",i.tgsb)}})},clearHtml:function(t,a,i){var n="";$.each(t,function(a,e){if(a%3==0&&(n+="<section>"),n+="\t<dl>\n            <dt>"+e.item_name+'</dt>\n            <dd>\n              <a href="http://cc.zeju.com/loupan/'+e.item_spell+"/"+e.item_id+'.html"  target="_blank" style="background-image:url(http://imgs.zeju.cn'+e.cover_pic+')">\n              <p>'+e.detail_addres+'</p>\n              </a>\n              <p class="piao">'+e.polls+'票</p>\n              <p class="toupiao"><span class="toupiaoBtn '+(e.is_voted?"":"jinzhi")+'" indexId="'+e.item_id+'" typeId="'+i+'">投票</span></p>\n            </dd>\n            </dl>',t.length%3!=0&&a+1==t.length/4*4)for(var s=3*Math.ceil(t.length/3)-(a+1),o=0;o<s;o++)n+='<dl style="background:transparent"><dd></dd></dl>';a%3==2&&(n+="</section>")}),$("#"+a).html(n)},clickToupiao:function(){var t=this;$(".seascape_main").on("click",".toupiaoBtn",function(a){if($(this).attr("class").indexOf("jinzhi")<0){if(t.endTime(),!t.end_flag)return!1;var i=$(this).attr("indexId"),n=$(this).attr("typeId"),e=getCookie("niandu_customer_id"),s=$(this);$.ajax({type:"POST",url:"http://webapi.zeju.com/pingxuan/votes",data:{visitor_id:e,item_id:i,city_name:t.city_name,item_type:n},success:function(t){s.addClass("jinzhi"),s.parent().prev(".piao").html(t.data.polls+"票")}})}})},clickChouBtn:function(t){var a=this;$("#zhuan_zhi_pc").on("click",function(){if(a.endTime(),!a.end_flag)return!1;var i=getCookie("niandu_customer_id"),n=getCookie("niandu_phone");null!=i?a.judgeChou({city_name:t,customer_id:i,phone:n}):(a.quoteAlert(a.tgsb,t,a.hd_name),$("#box_alert").css("display","block"))})},judgeChou:function(t){var a=this;$.ajax({type:"POST",url:"http://webapi.zeju.com/liuzi/hd_lppx_auth",data:{city_name:t.city_name,visitor_id:t.customer_id,phone:t.phone},success:function(t){if(200==t.status)if(t.data.usable_count>0){a.fanjiang();var i=$("#zhuan_yuan_pc").attr("data-num");$("#seascape_wrap").Turntable({oPointer:"#zhuan_zhi_pc",oTurntable:"#zhuan_yuan_pc",cat:60,temp:i,time:6},function(t){$("#box_alert").css("display","block");var i=a.alertHtml("3");$("#seascape_wrap").fromAlerts({formAsync:!0,cont:i})})}else{$("#box_alert").css("display","block");var n=a.alertHtml("4");$("#seascape_wrap").fromAlerts({formAsync:!0,cont:n})}else if(1==t.status){$("#box_alert").css("display","block");n=a.alertHtml("2");$("#seascape_wrap").fromAlerts({formAsync:!0,cont:n})}}})},fanjiang:function(){$.ajax({type:"POST",url:"http://webapi.zeju.com/liuzi/hd_lppx_yj",data:{phone:getCookie("niandu_phone"),city_name:this.city_name},success:function(t){200==t.status&&setCookie("sycishu",t.data.usable_count)}})},quoteAlert:function(t,a,i){var n=this.alertHtml(2);"pc"==t&&$("#seascape_wrap").fromAlerts({formAsync:!0,cont:n})},baseJia:function(t,a){var i=new Base64;return a?i.encode(t):i.decode(t)},alertHtml:function(t){var a="";if(2==t)a+='\n        <div class="box_main box_main2" id="box_main">\n          <header class="boxM_title"><b class="guan" id="alert_guan"></b></header>\n          <div class="boxM_text3">\n            <h4>前去提交投票信息，参与抽奖活动</h4>\n          </div>\n        </div>';else if(3==t){a+='\n        <div class="box_main box_main2" id="box_main">\n          <header class="boxM_title"><b class="guan" id="alert_guan"></b></header>\n          <div class="boxM_text3">\n            <h4>谢谢参与！</h4>\n            <p>剩余抽奖机会'+getCookie("sycishu")+"次</p>\n          </div>\n        </div>"}else if(4==t){getCookie("sycishu");a+='\n        <div class="box_main box_main2" id="box_main">\n          <header class="boxM_title"><b class="guan" id="alert_guan"></b></header>\n          <div class="boxM_text3">\n            <h4>抽奖次数已用完，感谢您关注择居2017年度楼盘评选活动</h4>\n          </div>\n        </div>'}return a},quoteLiuzi_footer:function(t,a,i){$("#seascape_wrap").Liuzi({huodongUrl:"http://webapi.zeju.com/liuzi/hd_lppx_liuzi",yanBtnColor:"yanzm_btncolor",clue_type_id:"6",tgsb:t,yanzmText:"获取",cityName:a,hd_name:i,layoutType:0,hd_alertArr:{repeatStr:"该手机号已参与活动",succeedStr:"投票成功，快去抽奖吧"}})},failData:function(t,a){var i=3;setInterval(function(){var n='<img src="/hd/assets/images/404.png"/><span><b>'+i+"</b>秒后跳转到首页...</span>";$("#body").html(n).addClass("body404"),$("#html").css("background","#fff"),0==--i&&(window.location.href="pc"==a?"http://"+t+".zeju.com/index":"http://m.zeju.com/"+t),$("#html").css("opacity","1")},1e3)},getZjfrom:function(){var t=null!=this.getQueryString("zjfrom")?this.getQueryString("zjfrom"):getCookie("zjfrom");return null!=t&&""!=t?t<10&&(t="0"+t):t="16",t},endTime:function(){var t=this;$.ajax({type:"GET",url:"http://webapi.zeju.com/pingxuan/end_flag",async:!1,success:function(a){if(200==a.status){if(t.end_flag=a.data.end_flag,!t.end_flag){var i=t.tiXingText();$("#seascape_wrap").fromAlerts({formAsync:!1,cont:i}),$("#box_alert").css("display","block")}}else t.end_flag=!0}})},tiXingText:function(){return'\n                <div class="box_main box_main2" id="box_main">\n                <header class="boxM_title"><b class="guan" id="alert_guan"></b></header>\n                <div class="boxM_text3">\n                  <div class="erweima_id" style="font-size:16px;width:100%;margin:0 0 20px;">活动已结束,请继续关注我们后续的活动！</div>\n                </div>\n              </div>'},footerBtn:function(){}},$.fn.extend({Public:function(t){return new a(i,t)}})}(window);