"use strict";!function(t){function i(t,i){var n={tgsb:"m"};for(var e in i)n[e]=i[e];this.tgsb=n.tgsb,this.city_name="",this.end_flag=!0,this.init()}var n=this;i.prototype={init:function(){this.city_name=null!=this.getQueryString("city")?this.getQueryString("city"):"cc",this.hd_name=this.fieldUrl(),this.itmeTab(),this.choujiang(this.city_name),this.footerBtn(),this.userName(),this.clickToupiao()},userName:function(){null==getCookie("niandu_customer_id")&&$.ajax({type:"GET",url:"http://webapi.zeju.com/pingxuan/visitor",success:function(t){200==t.status&&setCookie("niandu_customer_id",t.data.visitor_id)}})},clickToupiao:function(){var t=this;$("#loupanList").on("touchstart",".toupiao",function(i){if($(this).attr("class").indexOf("jinzhi")<0){if(t.endTime(),!t.end_flag)return!1;var n=$(this).attr("indexId"),e=$(this).attr("typeId"),a=getCookie("niandu_customer_id"),o=$(this);$.ajax({type:"POST",url:"http://webapi.zeju.com/pingxuan/votes",data:{visitor_id:a,item_id:n,city_name:t.city_name,item_type:e},success:function(t){o.addClass("jinzhi"),o.prev(".piao").html(t.data.polls+"票")}})}})},choujiang:function(t){var i=this;$("#zhuan_zhi_m").on("click",function(){if(i.endTime(),!i.end_flag)return!1;var n=getCookie("niandu_customer_id"),e=getCookie("niandu_phone");if(null!=n)i.judgeChou({city_name:t,customer_id:n,phone:e});else{i.alertChoujiang("前去提交投票信息，参与抽奖活动")}})},alertChoujiang:function(t){var i=2;$("#activeRuleClose").show(),$(".daoqi").html(t),setInterval(function(){0==i&&$("#activeRuleClose").hide(),i--},1e3)},judgeChou:function(t){var i=this;$.ajax({type:"POST",url:"http://webapi.zeju.com/liuzi/hd_lppx_auth",data:{city_name:t.city_name,visitor_id:t.customer_id,phone:t.phone},success:function(t){if(200==t.status)if(t.data.usable_count>0){i.fanjiang();var n=$("#zhuan_yuan_m").attr("data-num");$("#wrap").Turntable({oPointer:"#zhuan_zhi_pc",oTurntable:"#zhuan_yuan_m",cat:60,temp:n,time:6},function(t){var n="<h4>谢谢参与！</h4><p>剩余抽奖机会"+getCookie("sycishu")+"次</p>";i.alertChoujiang(n)})}else{var e="抽奖次数已用完，感谢您关注择居2017年度楼盘评选活动";i.alertChoujiang(e)}else if(1==t.status){e="前去提交投票信息，参与抽奖活动";i.alertChoujiang(e)}}})},fanjiang:function(){$.ajax({type:"POST",url:"http://webapi.zeju.com/liuzi/hd_lppx_yj",data:{phone:getCookie("niandu_phone"),city_name:this.city_name},success:function(t){200==t.status&&setCookie("sycishu",t.data.usable_count)}})},alertJiang:function(t){getCookie("zj_tow11_phone"),window.location.origin,window.location.pathname;"m"==this.tgsb&&($(".message").css({height:window.innerHeight+"px",width:window.innerWidth+"px"}).show(),window.scrollTo(0,0),$("body").on("touchmove",function(t){t.preventDefault},!1))},itmeTab:function(){var t=this;t.renderPage("1"),$("#city_box").on("click",".itmeCity",function(){$(this).addClass("on").siblings().removeClass("on");var i=$(this).attr("indexId");t.renderPage(i)})},getQueryString:function(t){var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(i);try{return decodeURI(n[2])}catch(t){try{return $URL.decode(n[2])}catch(t){return null}}},fieldUrl:function(){var t=window.location.pathname.split("/");return"hd"==t[1]?"2017ccndlppx":t[1]},liuzi:function(t,i,n){$(".wrap").Liuzi({huodongUrl:"http://webapi.zeju.com/liuzi/hd_lppx_liuzi",yanBtnColor:"yanzm_btncolor",tgsb:t,yanzmText:"获取",cityName:i,hd_name:n,layoutType:"0",hd_alertArr:{repeatStr:"该手机号已参与活动",succeedStr:"投票成功，快去抽奖吧"}})},renderPage:function(t){var i=this;$.ajax({type:"GET",url:"http://webapi.zeju.com/loupans/cclppx",data:{type:t,visitor_id:getCookie("niandu_customer_id")},success:function(n){if(200==n.status){var e=n.data;i.succeed_m_page(e,i.city_name,t),i.liuzi(i.tgsb,i.city_name,i.hd_name),$("#hd_phone").on("keyup",function(){11==$(this).val().length&&/^1[34578]\d{9}$/.test($(this).val())?$("#hd_yanzmBtn").addClass("yanzm_btncolor").attr({disabled:!1,style:""}):$("#hd_yanzmBtn").removeClass("yanzm_btncolor").attr({disabled:!0,style:""})})}else i.failData("cc",i.tgsb)}})},failData:function(t,i){var n=3;setInterval(function(){var e='<img src="/hd/assets/images/404.png"/><span><b>'+n+"</b>秒后跳转到首页...</span>";$("#body").html(e).addClass("body404"),0==--n&&(window.location.href="pc"==i?"http://"+t+".zeju.com/index":"http://m.zeju.com/"+t),$("#html").css("opacity","1")},1e3)},succeed_m_page:function(t,i,n){var e="";$.each(t,function(a,o){if(a%2==0&&(e+="<section>"),e+="\n            <dl>\n              <dt>"+o.item_name+'</dt>\n              <dd>\n                <a href="http://m.zeju.com/'+i+"/loupan/loupan_detail/"+o.item_id+'" target="_blank" style="background-image:url(http://imgs.zeju.cn/'+o.cover_pic+')">\n                  <p>'+o.detail_addres+'</p>\n                </a>\n                <div>\n                    <p class="piao">'+o.polls+'票</p>\n                    <p class="toupiao '+(o.is_voted?"":"jinzhi")+'" indexId="'+o.item_id+'" typeId="'+n+'">投票</p>\n                </div>\n              </dd>\n            </dl>',t.length%2!=0&&a+1==t.length/3*3)for(var s=2*Math.ceil(t.length/2)-(a+1),u=0;u<s;u++)e+='<dl style="background:transparent;"><dd style="border:none;"></dd></dl>';a%2==1&&(e+="</section>")}),$("#loupanList").html(e)},getZjfrom:function(){var t=null!=this.getQueryString("zjfrom")?this.getQueryString("zjfrom"):getCookie("zjfrom");return null!=t&&""!=t?t<10&&(t="0"+t):t="00",t},endTime:function(){var t=this;$.ajax({type:"GET",url:"http://webapi.zeju.com/pingxuan/end_flag",async:!1,success:function(i){200==i.status?(t.end_flag=i.data.end_flag,t.end_flag||$("#activeRuleClose").html('<div class="daoqi">活动已结束,请继续关注我们后续的活动！</div>').css("display","block")):t.end_flag=!0}})},footerBtn:function(){}},$.fn.extend({Public:function(t){return new i(n,t)}})}(window);